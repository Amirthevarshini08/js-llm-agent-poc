!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).LlmProvider=e()}(this,(function(){"use strict";const t={openai:{name:"OpenAI",models:["gpt-4","gpt-4-0613","gpt-4-32k","gpt-4-32k-0613","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo","gpt-3.5-turbo-16k","gpt-3.5-turbo-0613","gpt-3.5-turbo-16k-0613"],endpoint:"https://api.openai.com/v1/chat/completions"},groq:{name:"Groq",models:["llama2-70b-4096","mixtral-8x7b-32768"],endpoint:"https://api.groq.com/openai/v1/chat/completions"},together:{name:"Together AI",models:["mistralai/Mixtral-8x7B-Instruct-v0.1","mistralai/Mistral-7B-Instruct-v0.1","togethercomputer/Llama-2-7B-32K-Instruct","togethercomputer/llama-2-70b-chat"],endpoint:"https://api.together.xyz/v1/chat/completions"},custom:{name:"Custom",models:[],endpoint:""}},e="llmProvider",s="api-key-",i="selected-provider",n="selected-model",o="custom-endpoint",r="custom-models",a="No API key found. Please add your key.",l=t=>{const s=document.createElement(t);return s.classList.add(...Array.from(arguments).slice(1)),s};class d{constructor(c={}){this.options=Object.assign({container:null,providers:t,defaultProvider:"openai",onUpdate:()=>{} A,this.chat={completions:{create:async t=>(this.fetchApi(t))}},this._initialize()}async fetchApi(t){const s=this.provider,i=this.apiKey;if(!i)throw new Error(a);let n={...t};const o=this.providers[s];if(!o)throw new Error("Invalid provider selected");const r=o.endpoint;"custom"===s&&(n.endpoint=this.customEndpoint);let l=await fetch(n.endpoint||r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(t)});if(!l.ok){const t=await l.json();throw new Error(`API Error: ${t.error.message}`)}return l.json()}_initialize(){const t=this.options.container instanceof HTMLElement?this.options.container:document.querySelector(this.options.container);if(!t)return void console.error("LlmProvider: Container element not found.");this.providers=this.options.providers,this.container=t,this.provider=localStorage.getItem(i)||this.options.defaultProvider,this.model=localStorage.getItem(n),this.apiKey=localStorage.getItem(s+this.provider),this.customEndpoint=localStorage.getItem(o),this.customModels=localStorage.getItem(r),this.container.classList.add(e),this._render()}_render(){this.container.innerHTML="",this.container.appendChild(this._createProviderSelector()),"custom"===this.provider&&this.container.appendChild(this._createCustomProviderInputs()),this.container.appendChild(this._createModelSelector()),this.container.appendChild(this._createApiKeyInput())}_createProviderSelector(){const t=l("div","provider-selector","input-group","mb-3"),e=l("label","input-group-text");e.textContent="Provider";const s=l("select","form-select");s.id="provider-select";for(const t in this.providers)s.add(new Option(this.providers[t].name,t));return s.value=this.provider,s.addEventListener("change",(t=>{this.provider=t.target.value,localStorage.setItem(i,this.provider),this.apiKey=localStorage.getItem(s+this.provider)|_,"custom"===this.provider?this.model=this.customModels?this.customModels.split(",")[0]:"":this.model=this.providers[this.provider].models[0],localStorage.setItem(n,this.model),this._render(),this.options.onUpdate({provider:this.provider})})),t.appendChild(e),t.appendChild(s),t}_createModelSelector(){const t=l("div","model-selector","input-group","mb-3"),e=l("label","input-group-text");e.textContent="Model";const s=l("select","form-select");s.id="model-select";let i=[];return"custom"===this.provider?(this.customModels||"").split(",").forEach((t=>{t.trim()&&i.push(t.trim())})):i=this.providers[this.provider].models,i.forEach((t=>{s.add(new Option(t,t))})),this.model&&-1===i.indexOf(this.model)&&(this.model=i[0]),s.value=this.model,s.addEventListener("change",(t=>{this.model=t.target.value,localStorage.setItem(n,this.model),this.options.onUpdate({model:this.model})})),t.appendChild(e),t.appendChild(s),t}_createApiKeyInput(){const t=l("div","api-key-input","input-group","mb-3"),e=l("label","input-group-text");e.textContent="API Key";const i=l("input","form-control");return i.type="password",i.id="api-key-input",i.placeholder="Enter your API key here",i.value=this.apiKey||_ A,i.addEventListener("input",(e=>{this.apiKey=e.target.value,localStorage.setItem(s+this.provider,this.apiKey),this.options.onUpdate({apiKey:this.apiKey})})),t.appendChild(e),t.appendChild(i),t}_createCustomProviderInputs(){const t=l("div","custom-provider-inputs"),e=l("div","endpoint-input","input-group","mb-3"),s=l("label","input-group-text");s.textContent="Endpoint";const i=l("input","form-control");i.type="text",i.id="custom-endpoint-input",i.placeholder="Enter custom API endpoint",i.value=this.customEndpoint||_ A,i.addEventListener("input",(t=>{this.customEndpoint=t.target.value,localStorage.setItem(o,this.customEndpoint),this.options.onUpdate({customEndpoint:this.customEndpoint})})),e.appendChild(s),e.appendChild(i);const n=l("div","models-input","input-group","mb-3"),d=l("label","input-group-text");d.textContent="Models";const c=l("input","form-control");return c.type="text",c.id="custom-models-input",c.placeholder="Comma-separated model names",c.value=this.customModels||_ A,c.addEventListener("input",(t=>{this.customModels=t.target.value,localStorage.setItem(r,this.customModels),this.model=this.customModels.split(",")[0].trim(),this._render(),this.options.onUpdate({customModels:this.customModels})})),n.appendChild(d),n.appendChild(c),t.appendChild(e),t.appendChild(n),t}}return d}));
