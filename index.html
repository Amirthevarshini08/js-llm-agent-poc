<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Agent POC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f8f9fa; }
        #chat-window { display: flex; flex-direction: column; }
        .message { max-width: 80%; padding: 10px 15px; border-radius: 15px; margin-bottom: 10px; word-wrap: break-word; }
        .message.user { background-color: #0d6efd; color: white; align-self: flex-end; border-bottom-right-radius: 3px; }
        .message.assistant { background-color: #e9ecef; color: #333; align-self: flex-start; border-bottom-left-radius: 3px; }
        .message.tool, .message.tool-result { background-color: #f0f0f0; font-family: monospace; font-size: 0.85em; color: #555; align-self: center; width: 90%; border: 1px solid #ddd; margin-top: 5px; }
        .message.tool-result { background-color: #e6f7ff; border-color: #b3e0ff; }
        .message pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }
        .thinking { align-self: flex-start; color: #888; font-style: italic; }
    </style>
</head>
<body>
    <div class="container-fluid vh-100 d-flex flex-column p-0">
        <header class="p-3 bg-dark text-white shadow-sm">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">ðŸ¤– LLM Agent Proof-of-Concept</h4>
                <div id="llm-provider-selector" style="min-width: 300px;"></div>
            </div>
        </header>
        <div id="alert-container" class="position-absolute top-0 end-0 p-3" style="z-index: 1050;"></div>
        <main id="chat-window" class="flex-grow-1 p-3 overflow-auto"></main>
        <footer class="p-3 bg-light border-top">
            <form id="chat-form" class="d-flex">
                <input type="text" id="user-input" class="form-control me-2" placeholder="Interview me to create a blog post..." autocomplete="off" required>
                <button type="submit" class="btn btn-primary">Send</button>
            </form>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).LlmProvider=e()}(this,(function(){"use strict";const t={openai:{name:"OpenAI",url:"https://api.openai.com/v1",apiKeyUrl:"https://platform.openai.com/api-keys",models:["gpt-4o","gpt-4-turbo","gpt-3.5-turbo"]},groq:{name:"Groq",url:"https://api.groq.com/openai/v1",apiKeyUrl:"https://console.groq.com/keys",models:["llama3-8b-8192","llama3-70b-8192","mixtral-8x7b-32768","gemma-7b-it"]},cohere:{name:"Cohere",url:"https://api.cohere.com/v1",apiKeyUrl:"https://dashboard.cohere.com/api-keys",models:["command-r-plus","command-r","command","command-light"]},google:{name:"Google AI",url:"https://generativelanguage.googleapis.com/v1beta",apiKeyUrl:"https://makersuite.google.com/app/apikey",models:["gemini-1.5-pro-latest","gemini-pro"]}},e="llm-provider",s="llm-provider-api-key",i="llm-provider-model",r="chat/completions",o="models",a="generateContent",n={role:"user",parts:[{text:null}]},l={role:"model",parts:[{text:null}]},c={tool_calls:null},d={functionCall:null},h=t=>t.candidates[0].content.parts[0].text,p=t=>t.choices[0].message.content,u=t=>t.choices[0].message.tool_calls,m=t=>t.text;class g{constructor(t={}){this._element=document.getElementById("llm-provider-selector"),this._config=this._getConfig(t),this._createUi()}llm(){const t=this.provider();return t?new f({provider:t,apiKey:this.apiKey(),model:this.model()}):null}provider(){return localStorage.getItem(e)}apiKey(){return localStorage.getItem(s)}model(){return localStorage.getItem(i)}_getConfig(e){return{...{providers:t,initialProvider:null,initialApiKey:null},...e}}_createUi(){const t=this._config.initialProvider||localStorage.getItem(e),i=this._config.initialApiKey||localStorage.getItem(s);t&&localStorage.setItem("llm-provider",t),i&&localStorage.setItem("llm-provider-api-key",i);const r=document.createElement("div");r.className="input-group";const o=document.createElement("select");o.className="form-select",o.id="llmProviderSelect";const a=document.createElement("option");a.value="",a.textContent="Select a provider",a.selected=null==t,a.disabled=null!=t,o.appendChild(a),Object.keys(this._config.providers).forEach((e=>{const s=this._config.providers[e],i=document.createElement("option");i.value=e,i.textContent=s.name,i.selected=e==t,o.appendChild(i)})),r.appendChild(o);const n=document.createElement("input");n.type="password",n.className="form-control",n.id="llmProviderApiKey",n.placeholder="API Key",n.value=i||"",n.style.display=t?"block":"none",r.appendChild(n);const l=document.createElement("a");l.className="btn btn-outline-secondary",l.id="llmProviderApiKeyLink",l.target="_blank",l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key" viewBox="0 0 16 16"><path d="M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 9.5a.5.5 0 0 1-.354-.146L7.293 9l-.646.647a.5.5 0 0 1-.708 0L5.293 9l-.646.647a.5.5 0 0 1-.708 0L3.293 9l-.646.647a.5.5 0 0 1-.708 0L1.293 9l-.646.647A.5.5 0 0 1 0 9.5a.5.5 0 0 1-.354-.146L-.707 8.707A.5.5 0 0 1-.5 8H.5a.5.5 0 0 1 .354.146L1.293 8.5l.646-.647a.5.5 0 0 1 .708 0L3.293 8.5l.646-.647a.5.5 0 0 1 .708 0L5.293 8.5l.646-.647a.5.5 0 0 1 .708 0L7.293 8.5l.646-.647a.5.5 0 0 1 .708 0L9 8.5l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0L15 7.207l.646.647a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.354.146H7.465A4 4 0 0 1 0 8zm4-3a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/></svg>',l.style.display=t?"block":"none",l.href=this._config.providers[t]?.apiKeyUrl||"#",r.appendChild(l),this._element.appendChild(r),o.addEventListener("change",(t=>{const i=t.target.value;localStorage.setItem(e,i),n.style.display="block",l.style.display="block",l.href=this._config.providers[i]?.apiKeyUrl||"#",localStorage.removeItem(s),n.value=""})),n.addEventListener("input",(t=>{localStorage.setItem(s,t.target.value)}))}static getInstance(t){return g.instance||(g.instance=new g(t)),g.instance}}class f{constructor(e){const{provider:s,apiKey:i,model:r}=e,o=t[s].url;this.chat=new y({url:o,apiKey:i,model:r,provider:s})}}class y{constructor(t){const{url:e,apiKey:s,model:i,provider:a}=t;this._url=e,this._apiKey=s,this._model=i||"default",this._provider=a}async create(t){const e=this._isGoogleProvider()?this._transformToGoogle(t):t;return this._isGoogleProvider()?this._callGoogleApi(e):this._callApi(e)}_isGoogleProvider(){return"google"===this._provider}_callApi(t){return fetch(`${this._url}/${r}`,{method:"POST",headers:this._getHeaders(),body:JSON.stringify(t)}).then((t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}))}_callGoogleApi(t){return fetch(`${this._url}/${o}/${this._model}:${a}`,{method:"POST",headers:this._getHeadersGoogle(),body:JSON.stringify(t)}).then((t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()})).then((t=>this._transformFromGoogle(t)))}_getHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this._apiKey}`}}_getHeadersGoogle(){return{"Content-Type":"application/json","x-goog-api-key":this._apiKey}}_transformToGoogle(t){const e=t.messages.map((t=>"user"===t.role?(n.parts[0].text=t.content,n):"model"===t.role?(l.parts[0].text=t.content,l):void 0)).filter((t=>void 0!==t));return{contents:e}}_transformFromGoogle(t){let e;return e="tool_calls"in t?c:d,t.choices=[{message:{content:h(t),...e,role:"assistant"},index:0}],t.model=this._model,t.object="chat.completion",t.usage={prompt_tokens:null,completion_tokens:null,total_tokens:null},t}}return g}));
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const AIPIPE_API_KEY = 'eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6ImthdXRpa3N0dWR5QGdtYWlsLmNvbSJ9.nWSOYUOdkRUMhg3g4BB17rBf9s-UXD09PiR0UR_mMlQ'; // Remember to replace this!
            const chatWindow = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const alertContainer = document.getElementById('alert-container');
            const llmProvider = new LlmProvider(); 
            let messages = [{ role: 'system', content: 'You are a helpful assistant with access to tools. Use them to answer questions.' }];
            const tools = [
                { type: 'function', function: { name: 'google_search', description: 'Get search result snippets from Google for a given query.', parameters: { type: 'object', properties: { query: { type: 'string', description: 'The search query.' } }, required: ['query'] } } },
                { type: 'function', function: { name: 'execute_javascript', description: 'Executes a snippet of JavaScript code and returns the result.', parameters: { type: 'object', properties: { code: { type: 'string', description: 'The JavaScript code to execute.' } }, required: ['code'] } } }
            ];
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userMessage = userInput.value.trim();
                if (!userMessage) return;
                messages.push({ role: 'user', content: userMessage });
                addMessageToUI('user', userMessage);
                userInput.value = '';
                toggleInput(false);
                await runConversation();
                toggleInput(true);
            });
            async function runConversation() {
                addThinkingIndicator();
                try {
                    const llm = llmProvider.llm();
                    if (!llm) {
                        showAlert('Please select an LLM provider and enter your API key in the top-right corner.');
                        removeThinkingIndicator();
                        return;
                    }
                    const response = await llm.chat.completions.create({ model: llmProvider.model(), messages: messages, tools: tools, tool_choice: 'auto' });
                    const responseMessage = response.choices[0].message;
                    messages.push(responseMessage);
                    if (responseMessage.content) { addMessageToUI('assistant', responseMessage.content); }
                    if (responseMessage.tool_calls) {
                        const toolResults = await Promise.all(responseMessage.tool_calls.map(handleToolCall));
                        messages.push(...toolResults);
                        await runConversation();
                    }
                } catch (error) {
                    console.error('Error during conversation:', error);
                    showAlert(`An API or tool error occurred: ${error.message}`);
                } finally { removeThinkingIndicator(); }
            }
            async function handleToolCall(toolCall) {
                const functionName = toolCall.function.name;
                const args = JSON.parse(toolCall.function.arguments);
                let result = '';
                addMessageToUI('tool', `â–¶ï¸ Calling ${functionName}(${JSON.stringify(args)})`);
                try {
                    switch (functionName) {
                        case 'google_search': result = await executeGoogleSearch(args); break;
                        case 'execute_javascript': result = await executeJsCode(args); break;
                        default: result = `Error: Tool '${functionName}' not found.`;
                    }
                } catch (error) { result = `Error executing tool: ${error.message}`; }
                const resultString = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
                addMessageToUI('tool-result', `âœ… Result from ${functionName}:\n${resultString}`);
                return { tool_call_id: toolCall.id, role: 'tool', name: functionName, content: resultString };
            }
            async function executeGoogleSearch(args) {
                if (!AIPIPE_API_KEY || AIPIPE_API_KEY === 'YOUR_AIPIPE_API_KEY_HERE') throw new Error("AI Pipe API key not configured in the code.");
                const response = await fetch('https://aipipe.ai/api/v1/proxy/google_search', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${AIPIPE_API_KEY}` }, body: JSON.stringify({ query: args.query }) });
                if (!response.ok) throw new Error(`Google Search API failed with status ${response.status}`);
                const data = await response.json();
                return data.items?.map(item => ({ title: item.title, snippet: item.snippet })).slice(0, 5) || "No results found.";
            }
            async function executeJsCode(args) {
                try { return new Function(`'use strict'; return (${args.code})`)(); }
                catch (error) { return `Error: ${error.message}`; }
            }
            function addMessageToUI(role, content) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', role);
                const preElement = document.createElement('pre');
                preElement.textContent = content;
                messageElement.appendChild(preElement);
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
            function addThinkingIndicator() {
                const indicator = document.createElement('div');
                indicator.id = 'thinking-indicator';
                indicator.classList.add('message', 'thinking');
                indicator.textContent = 'Thinking...';
                chatWindow.appendChild(indicator);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
            function removeThinkingIndicator() {
                const indicator = document.getElementById('thinking-indicator');
                if (indicator) indicator.remove();
            }
            function toggleInput(enabled) {
                userInput.disabled = !enabled;
                chatForm.querySelector('button').disabled = !enabled;
            }
            function showAlert(message, type = 'danger') {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show" role="alert"><div>${message}</div><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`;
                alertContainer.append(wrapper);
            }
        });
    </script>
</body>
</html>
